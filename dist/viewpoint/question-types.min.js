angular.module("p97.questionTypes",["monospaced.elastic","google.places","angular-datepicker","ionic-timepicker"]),angular.module("p97.questionTypes").directive("qtLoader",function(e){return{restrict:"E",scope:{questions:"="},template:"<div class='row blocks'></div>",controller:function(t,r){t.addDirectives=function(){_.each(t.questions,function(n,o){n.form={show:!0},"undefined"==typeof n.value&&(n.value="");var l='<div class="question '+n.type+'" '+n.type+' question="questions['+o+']" value="questions['+o+'].value" control="questions['+o+'].form" ng-show="questions['+o+'].form.show"></div>',a=e(l)(t);r.parent().append(a)})},t.addDirectives()}}}),angular.module("p97.questionTypes").directive("datetime",["$http","$templateCache","$compile","$sce",function(e,t,r,n){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(o,l){if(o.question){var a=o.question.options;o.errors=[],o.getContentUrl=function(){return o.question.options.widget?BASE_TEMPLATE_URL+"datetime/templates/"+o.question.options.widget+".html":BASE_TEMPLATE_URL+"datetime/templates/"+platform+"/datetime.html"},o.renderHtml=function(e){return n.trustAsHtml(e)},o.internalControl=o.control||{},o.internalControl.validate_answer=function(){o.errors=[];var e=a.datejs_format||"MM/dd/yyyy HH:mm:ss",t=Date.parseExact(o.value,e);return a.required===!0?((null===t||isNaN(t))&&o.errors.push("Invalid format."),0===o.value.length&&o.errors.push("This field is required")):o.value.length>0&&(null===t||0/0===t)&&o.errors.push("Invalid format."),0===o.errors.length},o.internalControl.clean_answer=function(){},e.get(o.getContentUrl(),{cache:t}).success(function(e){var t=l.html(e).contents();r(t)(o)})}}}}]),angular.module("p97.questionTypes").directive("number",["$http","$templateCache","$compile","$sce",function(e,t,r,n){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(o,l){if(o.question){var a;isNumber=function(e){return""===e?!1:!isNaN(e)},o.setBlock=function(){a=o.question.options,o.errors=[],o.value=o.question.value,o.dummyValue=o.value},o.setBlock(),o.getContentUrl=function(){return o.question.options.widget?BASE_TEMPLATE_URL+"number/templates/"+o.question.options.widget+".html":BASE_TEMPLATE_URL+"number/templates/"+platform+"/number.html"},o.renderHtml=function(e){return n.trustAsHtml(e)},o.internalControl=o.control||{},o.internalControl.validate_answer=function(){if(o.errors=[],(!isNumber(o.value)||null==o.value)&&a.required&&a.required===!0)return o.errors.push("input must be a number"),!1;if(null!==o.value&&void 0!==o.value){if(!(""===o.value||isNumber(o.value)||a.required&&a.required!==!1))return o.errors.push("input must be a number"),!1;a.min&&isNumber(a.min)&&o.value<a.min&&o.errors.push("value must not be less than "+a.min),a.max&&isNumber(a.max)&&o.value>a.max&&o.errors.push("value must not be more than "+a.max)}return 0===o.errors.length},o.internalControl.clean_answer=function(){},o.$watch("dummyValue",function(e){o.value=isNumber(e)?parseFloat(e):e?e:""}),e.get(o.getContentUrl(),{cache:t}).success(function(e){var t=l.html(e).contents();r(t)(o)}),o.$on("reset-block",function(){console.log("[number] reset-block"),o.setBlock()})}}}}]),angular.module("p97.questionTypes").directive("textarea",["$http","$templateCache","$compile","$sce",function(e,t,r,n){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(o,l){if(o.getContentUrl=function(){return o.question.options.widget?BASE_TEMPLATE_URL+"textarea/templates/"+o.question.options.widget+".html":BASE_TEMPLATE_URL+"textarea/templates/"+platform+"/textarea.html"},o.renderHtml=function(e){return n.trustAsHtml(e)},o.question){var a=o.question.options;o.errors=[],o.char_count=0,o.word_count=0,o.internalControl=o.control||{},o.internalControl.validate_answer=function(){if(o.errors=[],null===o.value&&(o.value=""),a.required&&a.required===!0&&(""===o.value||0===o.char_count)&&o.errors.push("This field is required."),a.min_word&&o.word_count<a.min_word&&o.errors.push("You must have at least "+a.min_word+" words. You have "+o.word_count),a.max_word){var e=a.max_count||500;o.word_count>e?o.errors.push("You can have up to "+e+" words. You currently have "+o.word_count):o.word_count>a.max_word&&o.errors.push("You can only have "+a.max_word+" words. You have "+o.word_count)}return!a.min_word&&a.min_char&&o.char_count<a.min_char&&o.errors.push("You must have at least "+a.min_char+" characters. You have "+o.char_count),!a.max_word&&a.max_char&&o.char_count>a.max_char&&o.errors.push("You can only have "+a.max_char+" characters. You have "+o.char_count),0===o.errors.length},o.internalControl.clean_answer=function(){},o.$watch("value",function(e){if(e){var t,r=e.length;t=0===r?0:o.value.split(" ").length||0,o.char_count=r,o.word_count=t}}),e.get(o.getContentUrl(),{cache:t}).success(function(e){var t=l.html(e).contents();r(t)(o)})}}}}]),angular.module("p97.questionTypes").directive("yesNo",["$http","$templateCache","$compile","$sce",function(e,t,r,n){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(o,l){if(o.getContentUrl=function(){return o.question.options.widget?BASE_TEMPLATE_URL+"yes-no/templates/"+o.question.options.widget+".html":BASE_TEMPLATE_URL+"yes-no/templates/"+platform+"/yes-no.html"},o.renderHtml=function(e){return n.trustAsHtml(e)},o.question){var a=o.question.options;o.errors=[],o.internalControl=o.control||{},o.internalControl.validate_answer=function(){o.errors=[],a.required&&a.required===!0&&null===o.value&&o.errors.push("This field is required")},o.internalControl.clean_answer=function(){null===o.value&&(o.value=!1)},e.get(o.getContentUrl(),{cache:t}).success(function(e){var t=l.html(e).contents();r(t)(o)})}}}}]),angular.module("p97.questionTypes").directive("singleSelect",["$http","$templateCache","$compile","$injector","$sce","$formUtils","$vpApi",function(e,t,r,n,o,l,a){if(n.has("$ionicPopup"))var i=n.get("$ionicPopup");if(n.has("$modal"))var u=n.get("$modal");return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"=",current:"="},link:function(n,s){if(n.question){var c=/^[A-Za-z\d() _.,-]*$/,h=n.question.options;n.setBlock=function(){if(n.errors=[],h.filter){if(l&&a.db&&n.current)if(n.current.form.forEachItem&&""!=n.current.form.forEachItem.value){var e=l.getAnswer(null,h.filter,n.current.fsResp.id);null!==e&&(n.localChoices=_.filter(n.question.choices,function(e){return e.group_value===n.current.form.forEachItem.value}))}else{var e=l.getAnswer(null,h.filter,n.current.fsResp.id);null!==e&&(n.localChoices=_.filter(n.question.choices,function(t){return t.group_value===e.value}))}}else n.localChoices=angular.copy(n.question.choices);if(n.obj={otherValue:null},1===n.question.choices.length&&(n.value=n.question.choices[0].value),h.allow_other>0){var t={verbose:"Other",value:"other"};n.localChoices.push(t)}},n.setBlock(),n.getContentUrl=function(){return n.question.options.widget?BASE_TEMPLATE_URL+"single-select/templates/"+n.question.options.widget+".html":BASE_TEMPLATE_URL+"single-select/templates/"+platform+"/checkbox-single.html"},n.renderHtml=function(e){return o.trustAsHtml(e)},n.changeSelected=function(e){_.each(n.localChoices,function(t){t!==e?t.checked=!1:n.inputValue=t.checked===!0?t.value:""}),n.value=n.inputValue},n.checkPreviousAnswer=function(){if(n.value&&""!==n.value){if(choiceValues=_.pluck(n.localChoices,"value"),!_.contains(choiceValues,n.value)){var e={verbose:"User Entered: "+n.value,value:n.value};n.localChoices.splice(n.localChoices.length-1,0,e)}n.inputValue=n.value;var t=_.find(n.localChoices,{value:n.inputValue});t.checked=!0}},n.internalControl=n.control||{},n.internalControl.validate_answer=function(){return n.errors=[],h.required&&h.required===!0&&null===n.value&&n.errors.push("This field is required"),c.test(n.value)||n.errors.push("Your 'Other' input is invalid. Please try again without using special characters or symbols"),"other"===n.inputValue&&(n.otherValue&&null!==n.otherValue||n.errors.push("You selected 'Other'. It cannot be blank. Please fill in a response or select another choice")),0===n.errors.length},n.internalControl.clean_answer=function(){},n.otherInputModal=function(){if("hybrid"===platform){i.show({template:'<input type="text" ng-model="obj.otherValue">',title:"Other Option",scope:n,subTitle:"Please enter your input below",buttons:[{text:"Cancel",onTap:function(){n.cancelOther()}},{text:"<b>Confirm</b>",type:"button-positive",onTap:function(){n.confirmModalOtherValue()}}]})}"web"===platform&&(n.myOtherModal=u({scope:n,template:"templates/web/partials/other-input-modal.html",show:!0}))},e.get(n.getContentUrl(),{cache:t}).success(function(e){var t=s.html(e).contents();r(t)(n)}),n.$watch("inputValue",function(e){"other"===e?n.otherInputModal():(n.$emit("changed-value",{changedVal:e||"",questionSlug:n.question.slug}),n.value=e)}),n.confirmModalOtherValue=function(){if(0==n.otherValueCheck())return!1;_.each(n.localChoices,function(e){return"User Entered:"===e.verbose.substring(0,13)&&(n.localChoices=_.reject(n.localChoices,e)),n.localChoices});var e={verbose:"User Entered: "+n.obj.otherValue,value:n.obj.otherValue,checked:!0};n.localChoices.splice(n.localChoices.length-1,0,e),n.localChoices[n.localChoices.length-1].checked=!1,n.inputValue=n.obj.otherValue,n.obj.otherValue=""},n.otherValueCheck=function(){if(n.errorEmpty=!1,n.errorDuplicate=!1,n.errorLength=!1,null===n.obj.otherValue||""===n.obj.otherValue)return"hybrid"===platform&&i.alert({title:"No Entry Made",template:"No entry has been made. Please try again or click Cancel."}),"web"===platform&&(n.errorEmpty=!0),n.cancelOther(),!1;if(n.obj.otherValue.length>0){if(localContains=_.some(n.localChoices,function(e){return e.value==n.obj.otherValue}))return n.errorDuplicate=!1,"hybrid"===platform&&i.alert({title:"Duplicate Entries",template:"You have typed a duplicate answer. Please try again."}),"web"===platform&&(n.errorDuplicate=!0),n.obj.otherValue="",n.cancelOther(),!1;if(n.obj.otherValue.length>h.other_max_length)return"hybrid"===platform&&i.alert({title:"Too long",template:"You have typed an answer that is too long. Please try again."}),"web"===platform&&(n.errorLength=!0),n.cancelOther(),!1;n.closeModal=function(){"web"===platform&&n.errorLength===!1&&n.errorDuplicate===!1&&n.errorEmpty===!1&&n.myOtherModal.$promise.then(n.myOtherModal.hide)}}},n.cancelOther=function(){n.localChoices[n.localChoices.length-1].checked=!1,n.inputValue=""},n.checkPreviousAnswer(),n.$on("reset-block",function(){console.log("[single-select] reset-block"),n.setBlock(),n.value=n.question.value,n.checkPreviousAnswer()})}}}}]),angular.module("p97.questionTypes").directive("text",["$http","$templateCache","$compile","$sce",function(e,t,r,n){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(o,l){if(o.getContentUrl=function(){return o.question.options.widget?BASE_TEMPLATE_URL+"text/templates/"+o.question.options.widget+".html":BASE_TEMPLATE_URL+"text/templates/"+platform+"/text.html"},o.renderHtml=function(e){return n.trustAsHtml(e)},o.question){var a=o.question.options;o.errors=[],o.char_count=0,o.word_count=0,o.internalControl=o.control||{},o.internalControl.validate_answer=function(){if(o.errors=[],null===o.value&&(o.value=""),a.required&&a.required===!0&&(""===o.value||0===o.char_count)&&o.errors.push("This field is required."),a.min_word&&o.word_count<a.min_word&&o.errors.push("You must have at least "+a.min_word+" words. You have "+o.word_count),a.max_word){var e=a.max_count||20;o.word_count>e?o.errors.push("You can have up to "+e+" words. You currently have "+o.word_count):o.word_count>a.max_word&&o.errors.push("You can only have "+a.max_word+" words. You have "+o.word_count)}return!a.min_word&&a.min_char&&o.char_count<a.min_char&&o.errors.push("You must have at least "+a.min_char+" characters. You have "+o.char_count),!a.max_word&&a.max_char&&o.char_count>a.max_char&&o.errors.push("You can only have "+a.max_char+" characters. You have "+o.char_count),0===o.errors.length},o.internalControl.clean_answer=function(){},o.$watch("value",function(e){if(e){var t,r=e.length;t=0===r?0:o.value.split(" ").length||0,o.char_count=r,o.word_count=t}}),e.get(o.getContentUrl(),{cache:t}).success(function(e){var t=l.html(e).contents();r(t)(o)})}}}}]),angular.module("p97.questionTypes").directive("integer",["$http","$templateCache","$compile","$sce",function(e,t,r,n){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(o,l){if(o.question){var a;isInteger=function(e){return""===e?!1:(y=parseInt(e,10),"number"==typeof y&&e%1===0)},o.setBlock=function(){a=o.question.options,o.errors=[],o.value=o.question.value,o.dummyValue=o.value},o.setBlock(),o.getContentUrl=function(){return o.question.options.widget?BASE_TEMPLATE_URL+"integer/templates/"+o.question.options.widget+".html":BASE_TEMPLATE_URL+"integer/templates/"+platform+"/integer.html"},o.renderHtml=function(e){return n.trustAsHtml(e)},o.internalControl=o.control||{},o.internalControl.validate_answer=function(){if(o.errors=[],(!isInteger(o.value)||null==o.value)&&a.required&&a.required===!0)return o.errors.push("input must be a integer"),!1;if(null!==o.value&&void 0!==o.value){if(!(""===o.value||isInteger(o.value)||a.required&&a.required!==!1))return o.errors.push("input must be a integer"),!1;a.min&&isInteger(a.min)&&o.value<a.min&&o.errors.push("value must not be less than "+a.min),a.max&&isInteger(a.max)&&o.value>a.max&&o.errors.push("value must not be more than "+a.max)}return 0===o.errors.length},o.internalControl.clean_answer=function(){},o.$watch("dummyValue",function(e){o.value=isInteger(e)?parseInt(e):e?e:""}),e.get(o.getContentUrl(),{cache:t}).success(function(e){var t=l.html(e).contents();r(t)(o)}),o.$on("reset-block",function(){console.log("[integer] reset-block"),o.setBlock()})}}}}]),angular.module("p97.questionTypes").directive("email",["$http","$templateCache","$compile","$sce",function(e,t,r,n){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(o,l){if(o.question){var a=o.question.options;o.errors=[],o.getContentUrl=function(){return o.question.options.widget?BASE_TEMPLATE_URL+"email/templates/"+o.question.options.widget+".html":BASE_TEMPLATE_URL+"email/templates/"+platform+"/email.html"},o.renderHtml=function(e){return n.trustAsHtml(e)},o.internalControl=o.control||{},o.internalControl.validate_answer=function(){o.errors=[];var e=/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$/;return!e.test(o.value)&&a.required&&a.required===!0?(o.errors.push("input must be a valid email"),!1):e.test(o.value)||a.required&&a.required!==!1?0===o.errors.length:(o.errors.push("input must be a valid email"),!1)},o.internalControl.clean_answer=function(){},e.get(o.getContentUrl(),{cache:t}).success(function(e){var t=l.html(e).contents();r(t)(o)})}}}}]),angular.module("p97.questionTypes").directive("date",["$http","$templateCache","$compile","$sce",function(e,t,r,n){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(o,l){if(o.question){var a=angular.copy(o.question.options);if(o.datePickerOptions=a.settings,a.initial&&"yyyy"!==a.format&&(o.selectedDate=new Date(a.initial[0],a.initial[1]-1,a.initial[2])),"web"===platform&&(!a.default||"today"===a.default)&&""===o.value){var i=new Date;o.value=i}var u=/^(19|20)\d{2}$/;o.errors=[],o.getContentUrl=function(){return o.question.options.widget?BASE_TEMPLATE_URL+"date/templates/"+o.question.options.widget+".html":BASE_TEMPLATE_URL+"date/templates/"+platform+"/date.html"},o.renderHtml=function(e){return n.trustAsHtml(e)},o.internalControl=o.control||{},o.internalControl.validate_answer=function(){o.errors=[];var e=a.format;if(convertToDate=function(e){return new Date(e)},a&&a.required===!0&&(null==o.value||""==o.value||void 0==o.value))return o.errors.push("Invalid date format"),!1;if("yyyy"!==e){if(null!==o.value||""!==o.value){if(void 0==o.value)return o.errors.push("Invalid date format"),!1;a.min&&convertToDate(o.value)<convertToDate(a.min)&&o.errors.push("Your selected date is too low"),a.max&&convertToDate(o.value)>convertToDate(a.max)&&o.errors.push("Your selected date is too high")}}else null!==o.value&&void 0!==o.value&&o.value.length>0&&(u.test(o.value)||o.errors.push("Input must be a valid year"),a.min&&u.test(a.min)&&o.value<a.min&&o.errors.push("Year must not be lower than "+a.min),a.max&&u.test(a.max)&&o.value>a.max&&o.errors.push("Year must not be higher than "+a.max));return 0===o.errors.length},o.internalControl.clean_answer=function(){},e.get(o.getContentUrl(),{cache:t}).success(function(e){var t=l.html(e).contents();r(t)(o)})}}}}]),angular.module("p97.questionTypes").directive("phonenumber",["$http","$templateCache","$compile","$sce",function(e,t,r,n){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(o,l){if(o.question){var a=o.question.options;o.errors=[];var i=/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/,u=/^[0-9 ]+$/;o.getContentUrl=function(){return o.question.options.widget?BASE_TEMPLATE_URL+"phonenumber/templates/"+o.question.options.widget+".html":BASE_TEMPLATE_URL+"phonenumber/templates/"+platform+"/phonenumber.html"},o.renderHtml=function(e){return n.trustAsHtml(e)},o.internalControl=o.control||{},o.internalControl.validate_answer=function(){o.errors=[];a.default||"North America";return a.required&&a.required===!0&&null===o.value?(o.errors.push("This field is required"),!1):(a.format&&"North America"===a.format&&(i.test(o.value)||o.errors.push("input must be a valid North America phonenumber")),a.format&&"International"===a.format&&(u.test(o.value)||o.errors.push("input must be a valid International phonenumber")),0===o.errors.length)},o.internalControl.parse_phone=function(){if(a.format&&"North America"===a.format&&i.test(o.value)){var e="+"+a.country+" "+o.value.replace(i,"$1 $2$3");o.parsed_array=e.split(" ")}if(a.format&&"International"===a.format&&u.test(o.value)){var e="+"+a.country+" "+o.value;o.parsed_array=e.split(" ")}return o.parsed_array},o.internalControl.clean_answer=function(){return o.internalControl.cleaned_value=o.internalControl.parse_phone(),o.internalControl.cleaned_value},e.get(o.getContentUrl(),{cache:t}).success(function(e){var t=l.html(e).contents();r(t)(o)})}}}}]),angular.module("p97.questionTypes").directive("multiSelect",["$http","$templateCache","$compile","$injector","$sce",function(e,t,r,n,o){if(n.has("$ionicPopup"))var l=n.get("$ionicPopup");if(n.has("$modal"))var a=n.get("$modal");return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(n,i){if(n.question){var u=n.question.options,s=/^[A-Za-z\d() _.,-]*$/;n.setBlock=function(){if(n.showOtherInput=!1,n.choicesSelected=0,n.errors=[],n.valueArray=[],n.obj={otherValue:null},n.localChoices=angular.copy(n.question.choices),1===n.question.choices.length&&(n.value=n.question.choices[0].value),u.allow_other>0){var e={verbose:"Other",value:"other"};n.localChoices.push(e)}},n.setBlock(),n.getContentUrl=function(){return n.question.options.widget?BASE_TEMPLATE_URL+"multi-select/templates/"+n.question.options.widget+".html":BASE_TEMPLATE_URL+"multi-select/templates/"+platform+"/checkbox.html"},n.renderHtml=function(e){return o.trustAsHtml(e)},n.resetBlock=function(){n.setBlock(),n.value=n.question.value,n.togglePrevAnswers()},n.internalControl=n.control||{},n.internalControl.validate_answer=function(){return n.errors=[],n.choicesSelected=n.value.length,u.required&&u.required===!0&&0===n.value.length&&n.errors.push("This field is required"),u.max_choice&&n.choicesSelected>u.max_choice&&n.errors.push("You can have up to "+u.max_choice+" choices. You currently have "+n.choicesSelected),u.min_choice&&n.choicesSelected<u.min_choice&&n.errors.push("You need at least "+u.min_choice+" choices. You currently have "+n.choicesSelected),n.value.length>0&&_.each(n.value,function(e){s.test(e)?("other"===e&&!n.otherValue||null===n.otherValue)&&n.errors.push("You selected 'Other'. Please fill in a response or type in another choice"):n.errors.push("Your 'Other' input is invalid. Please try again without using special characters or symbols")}),0===n.errors.length},n.internalControl.clean_answer=function(){},n.addChoicesToArray=function(e){n.value&&""!==n.value&&(n.valueArray=n.value);var t=n.valueArray.indexOf(e);t>-1?n.valueArray.splice(t,1):n.valueArray.push(e),n.valueArray.length>0?n.value=n.valueArray:n.value},n.otherInputModal=function(){if("hybrid"===platform){l.show({template:'<input type="text" ng-model="obj.otherValue">',title:"Other Option",scope:n,subTitle:"Please enter your input below",buttons:[{text:"Cancel",onTap:function(){n.cancelOther()}},{text:"<b>Confirm</b>",type:"button-positive",onTap:function(){n.confirmModalOtherValue()}}]})}"web"===platform&&(n.myOtherModal=a({scope:n,template:"templates/web/partials/other-input-modal.html",show:!0}))},n.confirmModalOtherValue=function(){if(0==n.otherValueCheck())return!1;var e={verbose:"User Entered: "+n.obj.otherValue,value:n.obj.otherValue,checked:!0};n.localChoices.splice(n.localChoices.length-1,0,e),n.value[n.value.indexOf("other")]=n.obj.otherValue,n.localChoices[n.localChoices.length-1].checked=!1,n.obj.otherValue=""},n.otherValueCheck=function(){if(n.errorEmpty=!1,n.errorDuplicate=!1,n.errorLength=!1,null===n.obj.otherValue||""===n.obj.otherValue)return"hybrid"===platform&&l.alert({title:"No Entry Made",template:"No entry has been made. Please try again or click Cancel."}),"web"===platform&&(n.errorEmpty=!0),n.cancelOther(),!1;if(n.obj.otherValue.length>0){if(_.contains(n.value,n.obj.otherValue))return"hybrid"===platform&&l.alert({title:"Duplicate Entries",template:"You have typed a duplicate answer. Please try again."}),"web"===platform&&(n.errorDuplicate=!0),n.obj.otherValue="",n.cancelOther(),!1;if(n.obj.otherValue.length>u.other_max_length)return"hybrid"===platform&&l.alert({title:"Too long",template:"You have typed an answer that is too long. Please try again."}),"web"===platform&&(n.errorLength=!0),n.cancelOther(),!1;n.closeModal=function(){"web"===platform&&n.errorLength===!1&&n.errorDuplicate===!1&&n.errorEmpty===!1&&n.myOtherModal.$promise.then(n.myOtherModal.hide)}}},n.$watch("valueArray",function(e){e&&_.contains(e,"other")&&n.otherInputModal()},!0),n.togglePrevAnswers=function(){_.each(n.localChoices,function(e){e.checked=!1}),_.each(n.value,function(e){if(choiceValues=_.pluck(n.localChoices,"value"),_.contains(choiceValues,e)){var t=_.find(n.localChoices,function(t){return t.value===e});t.checked=!0}else{var r={verbose:"User Entered: "+e,value:e,checked:!0};n.localChoices.splice(n.localChoices.length-1,0,r)}})},n.cancelOther=function(){n.localChoices[n.localChoices.length-1].checked=!1,n.value=_.compact(_.without(n.value,"other")),n.valueArray=_.compact(_.without(n.valueArray,"other"))},n.togglePrevAnswers(),n.$on("reset-block",function(){console.log("[multi-select] reset-block"),n.resetBlock()}),e.get(n.getContentUrl(),{cache:t}).success(function(e){var t=i.html(e).contents();r(t)(n)})}}}}]),angular.module("p97.questionTypes").directive("toggle",["$http","$templateCache","$compile","$sce",function(e,t,r,n){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(o,l){if(o.getContentUrl=function(){return o.question.options.widget?BASE_TEMPLATE_URL+"toggle/templates/"+o.question.options.widget+".html":BASE_TEMPLATE_URL+"toggle/templates/"+platform+"/toggle.html"},o.renderHtml=function(e){return n.trustAsHtml(e)},o.question){var a=o.question.options;o.errors=[],"undefined"!=typeof o.question.value&&(o.localValue=o.question.value),o.internalControl=o.control||{},o.internalControl.validate_answer=function(){return o.value===a.choices.positiveValue||o.value===a.choices.negativeValue?!0:void 0},o.internalControl.clean_answer=function(){},o.$watch("localValue",function(e){o.value=e===!0?a.choices.positiveValue||!0:a.choices.negativeValue||!1}),e.get(o.getContentUrl(),{cache:t}).success(function(e){var t=l.html(e).contents();r(t)(o)})}}}}]),angular.module("p97.questionTypes").directive("autocompleteSearch",["$http","$templateCache","$compile","$sce",function(e,t,r,n){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(o,l){if(o.getContentUrl=function(){return o.question.options.widget?BASE_TEMPLATE_URL+"autocomplete-search/templates/"+o.question.options.widget+".html":BASE_TEMPLATE_URL+"autocomplete-search/templates/"+platform+"/autocomplete.html"},o.renderHtml=function(e){return n.trustAsHtml(e)},o.question){var a=o.question.options;o.autocompleteOptions={componentRestrictions:{country:"us"},types:[],stateFilter:a.stateRestrict||[]},o.internalControl=o.control||{},o.internalControl.validate_answer=function(){return o.errors=[],null===o.value&&(o.value=""),!a.required||a.required!==!0||0!==o.value.length&&""!==o.value||o.errors.push("This field is required"),0===o.errors.length},o.internalControl.clean_answer=function(){},e.get(o.getContentUrl(),{cache:t}).success(function(e){var t=l.html(e).contents();r(t)(o)})}}}}]),angular.module("p97.questionTypes").directive("info",["$http","$templateCache","$compile","$sce",function(e,t,r,n){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(o,l){if(o.getContentUrl=function(){return o.question.options.widget?BASE_TEMPLATE_URL+"info/templates/"+o.question.options.widget+".html":BASE_TEMPLATE_URL+"info/templates/"+platform+"/info.html"},o.renderHtml=function(e){return n.trustAsHtml(e)},o.question){{o.question.options}o.internalControl=o.control||{},o.internalControl.validate_answer=function(){return o.errors=[],null===o.value&&(o.value=""),0===o.errors.length},o.internalControl.clean_answer=function(){},e.get(o.getContentUrl(),{cache:t}).success(function(e){var t=l.html(e).contents();r(t)(o)})}}}}]),angular.module("p97.questionTypes").directive("geojson",["$q","$http","$templateCache","$compile","$timeout","$window","$ionicLoading","$sce",function(e,t,r,n,o,l,a,i){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(e,o){if(e.errors=[],e.getContentUrl=function(){return e.question.options.widget?BASE_TEMPLATE_URL+"geojson/templates/"+e.question.options.widget+".html":BASE_TEMPLATE_URL+"geojson/templates/"+platform+"/geojson.html"},e.renderHtml=function(e){return i.trustAsHtml(e)},e.question){{e.question.options}e.internalControl=e.control||{},e.internalControl.validate_answer=function(){if(e.errors=[],out=!0,e.question.options.required===!0)if(0===e.value.length)out=!1,e.errors.push("A location is required.");else{var t=JSON.parse(e.value);0===t.features.length&&(out=!1,e.errors.push("A location is required."))}return out},e.internalControl.clean_answer=function(){},t.get(e.getContentUrl(),{cache:r}).success(function(t){var r=o.html(t).contents();n(r)(e)})}}}}]),angular.module("p97.questionTypes").directive("numpad",["$http","$templateCache","$compile","$sce",function(e,t,r,n){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(o,l){if(o.question){{o.question.options}o.getContentUrl=function(){return o.question.options.widget?BASE_TEMPLATE_URL+"numpad/templates/"+o.question.options.widget+".html":BASE_TEMPLATE_URL+"numpad/templates/"+platform+"/numpad.html"},o.renderHtml=function(e){return n.trustAsHtml(e)},o.keypad=[["1","2","3"],["4","5","6"],["7","8","9"],["0",".","DEL"]],o.display=["0"],o.input=function(e){return"0"!==o.display&&_.contains(o.display,".")&&"."===e?o.display:void("DEL"==e?o.remove():"0"==o.display&&/[0-9]/.test(e)?o.display=[e]:o.display.push(e))},o.remove=function(){o.display.pop(),0==o.display.length&&(o.display=["0"])},o.compute=function(){return Number(o.display.join(""))},o.internalControl=o.control||{},o.internalControl.validate_answer=function(){return o.errors=[],0===o.errors.length},o.internalControl.clean_answer=function(){},e.get(o.getContentUrl(),{cache:t}).success(function(e){var t=l.html(e).contents();r(t)(o)}),o.$watch("compute()",function(e){o.value=e}),o.$on("reset-numpad",function(){for(;o.display.length>0&&"0"!=o.display[0];)o.remove()})}}}}]),angular.module("p97.questionTypes").directive("time",["$http","$templateCache","$compile","$sce",function(e,t,r,n){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(o,l){if(o.question){var a=o.question.options;o.getContentUrl=function(){return o.question.options.widget?BASE_TEMPLATE_URL+"time/templates/"+o.question.options.widget+".html":BASE_TEMPLATE_URL+"time/templates/"+platform+"/time.html"},o.renderHtml=function(e){return n.trustAsHtml(e)},o.getPickersUnits=function(e){if(void 0!==a.initial){var t=(e.replace(/\D/g,""),e.substring(0,2)),r=e.substring(3,5);if(12===a.format&&"12"!==t&&"AM"===e.slice(-2)||12===a.format&&"12"===t&&"PM"===e.slice(-2)||24===a.format)return 3600*parseInt(t)+60*parseInt(r);if("12"!==t&&"PM"===e.slice(-2))return 3600*(parseInt(t)+12)+60*parseInt(r);if("12"===t&&"AM"===e.slice(-2))return 60*parseInt(r)}},o.slots={epochTime:o.getPickersUnits(a.initial)||null,format:a.format||24,step:a.increments||15},o.getTime=function(){if(null===o.slots.epochTime)return"Please Select a Time";var e=o.slots.epochTime/3600,t=Math.floor(e),r=Math.round(60*(e-t)),n=t-12;return doubleZero=function(e){return 0===e?"00":10>e?"0"+e:e},24===o.slots.format?t+":"+doubleZero(r):o.slots.epochTime<43200?0===t?"12:"+doubleZero(r)+" AM":t+":"+doubleZero(r)+" AM":o.slots.epochTime>=43200&&o.slots.epochTime<46800?"12:"+doubleZero(r)+" PM":n+":"+doubleZero(r)+" PM"},o.internalControl=o.control||{},o.internalControl.validate_answer=function(){return o.errors=[],a.required&&a.required===!0&&"Please Select a Time"===o.value&&o.errors.push("This field is required"),0===o.errors.length},o.internalControl.clean_answer=function(){},e.get(o.getContentUrl(),{cache:t}).success(function(e){var t=l.html(e).contents();r(t)(o)}),o.$watch("getTime()",function(e){o.value="Please Select a Time"!==e||a.required&&a.required!==!1?e:""})}}}}]),angular.module("p97.questionTypes").directive("mapMultiSelect",["$http","$templateCache","$compile","$sce","$timeout",function(e,t,r,n,o){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(l,a){function i(e,t){var r=u.geojsonChoices;t.on("click",function(e){if("featureCollection"===u.type)var n=e.target.feature;else var n=e.target.feature.properties.id;var o=_.contains(l.selectedFeatures,n);o?(t.setStyle({fillOpacity:r.style.fillOpacity}),index=_.indexOf(l.selectedFeatures,n),l.selectedFeatures.splice(index,1)):(t.setStyle({color:r.style.color,fillColor:r.clickStyle.fillColor,fillOpacity:r.clickStyle.fillOpacity}),l.selectedFeatures.push(n),isInteger(n)&&l.selectedFeatures.sort(function(e,t){return e-t})),l.$apply(function(){l.value="featureCollection"===u.type&&l.selectedFeatures.length>0?l.geoCollection:l.selectedFeatures.length>0?l.selectedFeatures:""})})}if(l.question){var u=l.question.options;"featureCollection"===u.type?(l.geoCollection={"type:":"FeatureCollection",features:[]},l.selectedFeatures=l.geoCollection.features):l.selectedFeatures=[],l.getContentUrl=function(){return l.question.options.widget?BASE_TEMPLATE_URL+"map-multi-select/templates/"+l.question.options.widget+".html":BASE_TEMPLATE_URL+"map-multi-select/templates/"+platform+"/map-multi-select.html"},l.renderHtml=function(e){return n.trustAsHtml(e)},isInteger=function(e){return""===e?!1:(y=parseInt(e,10),"number"==typeof y&&e%1===0)},l.internalControl=l.control||{},l.internalControl.validate_answer=function(){return l.errors=[],u.required&&u.required===!0&&0===l.value.length&&l.errors.push("A location is required."),0===l.errors.length},l.internalControl.clean_answer=function(){},e.get(l.getContentUrl(),{cache:t}).success(function(t){var n=a.html(t).contents();r(n)(l),l.map=L.map("map").setView(u.initial.center,u.initial.zoom);
var s={},c={},h=[],p=u.tileSources;_.each(p,function(e){var t={maxZoom:e.maxZoom,attribution:e.attrib,dbOnly:!1,onReady:function(){},onError:function(){},storeName:e.storeName,subdomains:e.subdomain,dbOption:"IndexedDB"};if("NOAA Nautical Charts"!==e.name&&"Bing"!==e.name){c=L.tileLayer(e.url,t);var r=e.name;s[r]=c,h.push(c)}if("Bing"===e.name){var n=new L.BingLayer("Av8HukehDaAvlflJLwOefJIyuZsNEtjCOnUB_NtSTCwKYfxzEMrxlKfL1IN7kAJF",{type:e.type||"AerialWithLabels"});s[e.name]=n,h.push(n)}if("NOAA Nautical Charts"===e.name){var o=new L.tileLayer.wms("http://seamlessrnc.nauticalcharts.noaa.gov/arcgis/services/RNC/NOAA_RNC/ImageServer/WMSServer",{format:"img/png",transparent:!0,layers:null,attribution:'Tiles Courtesy of <a href="http://www.nauticalcharts.noaa.gov/csdl/seamlessraster.html">NOAA &reg;</a> &mdash; <a href="http://www.nauticalcharts.noaa.gov/mcd/Raster/download_agreement.htm">User Agreement</a> '});s[e.name]=o,h.push(o)}}),o(function(){h[0].addTo(l.map),s.length>1&&L.control.layers(s).addTo(l.map)}),L.TopoJSON=L.GeoJSON.extend({addData:function(e){if("Topology"===e.type)for(key in e.objects)geojson=topojson.feature(e,e.objects[key]),L.GeoJSON.prototype.addData.call(this,geojson);else L.GeoJSON.prototype.addData.call(this,e)}}),u.hasOwnProperty("geojsonChoices")&&e.get(u.geojsonChoices.path).success(function(e){var t=new L.TopoJSON(e,{style:u.geojsonChoices.style,onEachFeature:i});t.addTo(l.map).bringToFront()})})}}}}]);